<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MF Orçamento - Contas</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
</head>
<body>
    <div id="login-overlay">
    <div class="login-container">
        <img src="icon-192.png" alt="Ícone do App" style="width: 80px; margin-bottom: 20px;">
        <h2>Acesso Restrito</h2>
        <p>Por favor, digite sua senha para continuar.</p>
        <input type="password" id="password-input" placeholder="Senha">
        <button id="login-button">Entrar</button>
    </div>
</div>

    <header>
        <a href="index.html" style="color: white; text-decoration: none;">
            <i class="fa-solid fa-arrow-left"></i>
        </a>
        <h1>Contas</h1>
        <i class="fa-solid fa-magnifying-glass"></i>
    </header>

    <main>
        <section class="card">
            <h2>Suas Contas</h2>
            <ul id="accounts-list" class="transaction-list">
                </ul>
        </section>
    </main>

    <button id="fab-add-account" class="fab">+</button>

    <div id="add-account-modal" class="modal-overlay">
        <div class="modal-content">
            <h2>Nova Conta</h2>
            <input type="text" id="account-name-input" placeholder="Nome da Conta (ex: Poupança)">
            <input type="number" id="account-balance-input" placeholder="Saldo Inicial (ex: 100.00)">
            <div class="modal-actions">
                <button id="cancel-add-button">Cancelar</button>
                <button id="add-button">Adicionar</button>
            </div>
        </div>
    </div>

    <div id="edit-account-modal" class="modal-overlay">
        <div class="modal-content">
            <h2 id="edit-modal-title">Editar Saldo</h2>
            <input type="number" id="edit-balance-input" placeholder="Novo Saldo">
            <input type="hidden" id="edit-account-id">
            <div class="modal-actions">
                <button id="cancel-edit-button">Cancelar</button>
                <button id="save-edit-button">Salvar</button>
            </div>
        </div>
    </div>
    
    <script>
    document.addEventListener('DOMContentLoaded', () => {

                // --- INÍCIO DA LÓGICA DE LOGIN ---
        const correctPassword = "]T]#6CqHSiUDnAZ9b6gt";
        const loginOverlay = document.getElementById('login-overlay');
        const passwordInput = document.getElementById('password-input');
        const loginButton = document.getElementById('login-button');

        // Verifica se o usuário já está logado nesta sessão
        if (sessionStorage.getItem('isLoggedIn') !== 'true') {
            loginOverlay.style.display = 'flex'; // Mostra a tela de bloqueio
        } else {
            loginOverlay.style.display = 'none'; // Esconde a tela se já estiver logado
        }

        // Função para tentar o login
        function attemptLogin() {
            if (passwordInput.value === correctPassword) {
                sessionStorage.setItem('isLoggedIn', 'true'); // Marca como logado na sessão
                loginOverlay.style.display = 'none'; // Esconde a tela de bloqueio
            } else {
                alert('Senha incorreta!');
                passwordInput.value = '';
            }
        }

        loginButton.addEventListener('click', attemptLogin);
        passwordInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                attemptLogin();
            }
        });
        // --- FIM DA LÓGICA DE LOGIN ---
        
        // --- SELEÇÃO DOS ELEMENTOS ---
        const accountsList = document.getElementById('accounts-list');
        const fabButton = document.getElementById('fab-add-account');
        const addModal = document.getElementById('add-account-modal');
        const cancelAddBtn = document.getElementById('cancel-add-button');
        const addBtn = document.getElementById('add-button');
        const accountNameInput = document.getElementById('account-name-input');
        const accountBalanceInput = document.getElementById('account-balance-input');
        const editModal = document.getElementById('edit-account-modal');
        const editModalTitle = document.getElementById('edit-modal-title');
        const cancelEditBtn = document.getElementById('cancel-edit-button');
        const saveEditBtn = document.getElementById('save-edit-button');
        const editBalanceInput = document.getElementById('edit-balance-input');
        const editAccountIdInput = document.getElementById('edit-account-id');


        // --- BANCO DE DADOS LOCAL (localStorage) ---
        const getAccounts = () => JSON.parse(localStorage.getItem('accounts')) || [];
        const saveAccounts = (accounts) => localStorage.setItem('accounts', JSON.stringify(accounts));


        // --- FUNÇÕES DA APLICAÇÃO ---
        function loadAccounts() {
            const accounts = getAccounts();
            accountsList.innerHTML = '';
            accounts.forEach(account => {
                const balanceColor = account.balance < 0 ? 'expense' : 'income';
                const formattedBalance = account.balance.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
                const icon = account.name.toLowerCase().includes('cartão') ? 'fa-credit-card' : 'fa-wallet';

                // ** MUDANÇA AQUI: Adicionado <i> de lixeira e movido cursor para os detalhes **
                const accountHTML = `
                    <li class="transaction-item" data-id="${account.id}">
                        <div class="icon-container" style="background-color: #78909c;"><i class="fa-solid ${icon}"></i></div>
                        <div class="transaction-details" style="cursor: pointer;">
                            <span class="name">${account.name}</span>
                        </div>
                        <div class="transaction-amount ${balanceColor}" style="cursor: pointer;">
                            <span>${formattedBalance}</span>
                        </div>
                        <i class="fa-solid fa-trash delete-icon"></i>
                    </li>
                `;
                accountsList.insertAdjacentHTML('beforeend', accountHTML);
            });
        }

        function addAccount() {
            const name = accountNameInput.value.trim();
            const balance = parseFloat(accountBalanceInput.value) || 0;
            if (!name) {
                alert('Por favor, digite o nome da conta.');
                return;
            }
            const newAccount = { id: new Date().getTime(), name: name, balance: balance };
            const accounts = getAccounts();
            accounts.push(newAccount);
            saveAccounts(accounts);
            loadAccounts();
            closeAddModal();
        }

        function saveAccountEdit() {
            const accountId = parseInt(editAccountIdInput.value);
            const newBalance = parseFloat(editBalanceInput.value);
            if (isNaN(newBalance)) {
                alert('Por favor, insira um valor válido.');
                return;
            }
            const accounts = getAccounts();
            const accountIndex = accounts.findIndex(acc => acc.id === accountId);
            if (accountIndex > -1) {
                accounts[accountIndex].balance = newBalance;
                saveAccounts(accounts);
                loadAccounts();
                closeEditModal();
            }
        }
        
        // ** NOVA FUNÇÃO PARA DELETAR CONTA **
        function deleteAccount(id) {
            let accounts = getAccounts();
            // Filtra o array, mantendo apenas as contas com ID diferente
            accounts = accounts.filter(account => account.id !== id);
            saveAccounts(accounts);
            loadAccounts(); // Recarrega a lista na tela
        }

        // --- LÓGICA DOS MODAIS E EVENTOS ---
        const openAddModal = () => { addModal.style.display = 'flex'; accountNameInput.focus(); };
        const closeAddModal = () => { 
            addModal.style.display = 'none'; 
            accountNameInput.value = '';
            accountBalanceInput.value = '';
        };

        const openEditModal = (account) => {
            editModalTitle.textContent = `Editar Saldo de ${account.name}`;
            editBalanceInput.value = account.balance;
            editAccountIdInput.value = account.id;
            editModal.style.display = 'flex';
            editBalanceInput.focus();
        };
        const closeEditModal = () => { editModal.style.display = 'none'; };

        // Event Listeners
        fabButton.addEventListener('click', openAddModal);
        cancelAddBtn.addEventListener('click', closeAddModal);
        addBtn.addEventListener('click', addAccount);
        saveEditBtn.addEventListener('click', saveAccountEdit);
        cancelEditBtn.addEventListener('click', closeEditModal);

        // ** MUDANÇA AQUI: Event Listener da lista agora diferencia entre DELETAR e EDITAR **
        accountsList.addEventListener('click', (event) => {
            const accountItem = event.target.closest('.transaction-item');
            if (!accountItem) return; // Se o clique não foi em um item, não faz nada

            const accountId = parseInt(accountItem.dataset.id);
            const accounts = getAccounts();
            const accountClicked = accounts.find(acc => acc.id === accountId);

            // Verifica se o clique foi no ícone de lixeira
            if (event.target.classList.contains('delete-icon')) {
                if (confirm(`Tem certeza que deseja excluir a conta "${accountClicked.name}"?`)) {
                    deleteAccount(accountId);
                }
            } else {
                // Se não foi no ícone de lixeira, abre o modal de edição
                if (accountClicked) {
                    openEditModal(accountClicked);
                }
            }
        });

        // --- INICIALIZAÇÃO ---
        loadAccounts();
    });
    </script>

</body>
</html>
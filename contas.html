<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MF Orçamento - Contas</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <link rel="manifest" href="manifest.json">
</head>
<body>
    <div id="login-overlay">
        <div class="login-container">
            <img src="icon-192.png" alt="Ícone do App" style="width: 80px; margin-bottom: 20px;">
            <h2 id="auth-title">Acesso Restrito</h2>
            <p id="auth-message">Por favor, digite sua senha para continuar.</p>
            <div class="auth-inputs">
                <input type="password" id="password-input" placeholder="Senha">
                <input type="password" id="password-confirm-input" placeholder="Confirme a Senha" style="display: none;">
            </div>
             <p id="auth-error" style="color: #c62828; display: none; margin-top: 10px;"></p>
            <button id="auth-button">Entrar</button>
        </div>
    </div>

    <header>
        <a href="index.html" style="color: white; text-decoration: none;">
            <i class="fa-solid fa-arrow-left"></i>
        </a>
        <h1>Contas</h1>
        <i class="fa-solid fa-magnifying-glass" style="opacity: 0;"></i>
    </header>

    <main>
        <section class="card">
            <h2>Suas Contas</h2>
            <ul id="accounts-list" class="transaction-list">
                </ul>
        </section>
    </main>

    <button id="fab-add-account" class="fab">+</button>

    <div id="add-account-modal" class="modal-overlay">
        <div class="modal-content">
            <h2>Nova Conta</h2>
            <input type="text" id="account-name-input" placeholder="Nome da Conta (ex: Poupança)">
            <input type="number" id="account-balance-input" placeholder="Saldo Inicial (ex: 100.00)">
            <div class="modal-actions">
                <button id="cancel-add-button">Cancelar</button>
                <button id="add-button">Adicionar</button>
            </div>
        </div>
    </div>

    <div id="edit-account-modal" class="modal-overlay">
        <div class="modal-content">
            <h2 id="edit-modal-title">Editar Saldo</h2>
            <input type="number" id="edit-balance-input" placeholder="Novo Saldo">
            <input type="hidden" id="edit-account-id">
            <div class="modal-actions">
                <button id="cancel-edit-button">Cancelar</button>
                <button id="save-edit-button">Salvar</button>
            </div>
        </div>
    </div>
    
    <script>
    document.addEventListener('DOMContentLoaded', () => {

        // --- INÍCIO DA LÓGICA DE LOGIN ---
        const USER_STORAGE_KEY = 'mf-orcamento-user';
        const loginOverlay = document.getElementById('login-overlay');
        const passwordInput = document.getElementById('password-input');
        const passwordConfirmInput = document.getElementById('password-confirm-input');
        const authButton = document.getElementById('auth-button');
        const authTitle = document.getElementById('auth-title');
        const authMessage = document.getElementById('auth-message');
        const authError = document.getElementById('auth-error');

        function getUserCredentials() {
            const data = localStorage.getItem(USER_STORAGE_KEY);
            return data ? JSON.parse(data) : null;
        }

        function handleLogin() {
            const credentials = getUserCredentials();
            if (passwordInput.value === credentials.password) {
                sessionStorage.setItem('isLoggedIn', 'true');
                loginOverlay.style.display = 'none';
                initializeApp(); // Carrega o conteúdo da página após login
            } else {
                authError.textContent = 'Senha incorreta!';
                authError.style.display = 'block';
                passwordInput.value = '';
            }
        }
        
        function handleRegistration() {
            // Se o usuário está nesta página e não tem senha,
            // redireciona para a principal para poder cadastrar.
            window.location.href = './index.html';
        }

        function setupAuthScreen() {
            const credentials = getUserCredentials();
            if (credentials) {
                authTitle.textContent = 'Acesso Restrito';
                authMessage.textContent = 'Por favor, digite sua senha para continuar.';
                passwordConfirmInput.style.display = 'none';
                authButton.textContent = 'Entrar';
                authButton.onclick = handleLogin;
                passwordInput.onkeypress = (e) => { if (e.key === 'Enter') handleLogin(); };
            } else {
                // Se não existe usuário, a única opção segura é ir para a página principal
                handleRegistration();
            }
        }

        if (sessionStorage.getItem('isLoggedIn') !== 'true') {
            loginOverlay.style.display = 'flex';
            setupAuthScreen();
        } else {
            loginOverlay.style.display = 'none';
        }
        // --- FIM DA LÓGICA DE LOGIN ---
        
        const accountsList = document.getElementById('accounts-list');
        const fabButton = document.getElementById('fab-add-account');
        const addModal = document.getElementById('add-account-modal');
        const cancelAddBtn = document.getElementById('cancel-add-button');
        const addBtn = document.getElementById('add-button');
        const accountNameInput = document.getElementById('account-name-input');
        const accountBalanceInput = document.getElementById('account-balance-input');
        const editModal = document.getElementById('edit-account-modal');
        const editModalTitle = document.getElementById('edit-modal-title');
        const cancelEditBtn = document.getElementById('cancel-edit-button');
        const saveEditBtn = document.getElementById('save-edit-button');
        const editBalanceInput = document.getElementById('edit-balance-input');
        const editAccountIdInput = document.getElementById('edit-account-id');

        const getAccounts = () => JSON.parse(localStorage.getItem('accounts')) || [];
        const saveAccounts = (accounts) => localStorage.setItem('accounts', JSON.stringify(accounts));

        function loadAccounts() {
            const accounts = getAccounts();
            accountsList.innerHTML = '';
            accounts.forEach(account => {
                const balanceColor = account.balance < 0 ? 'expense' : 'income';
                const formattedBalance = account.balance.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
                const icon = account.name.toLowerCase().includes('cartão') ? 'fa-credit-card' : 'fa-wallet';

                const accountHTML = `
                    <li class="transaction-item" data-id="${account.id}">
                        <div class="icon-container" style="background-color: #78909c;"><i class="fa-solid ${icon}"></i></div>
                        <div class="transaction-details" style="cursor: pointer;">
                            <span class="name">${account.name}</span>
                        </div>
                        <div class="transaction-amount ${balanceColor}" style="cursor: pointer;">
                            <span>${formattedBalance}</span>
                        </div>
                        <i class="fa-solid fa-trash delete-icon"></i>
                    </li>
                `;
                accountsList.insertAdjacentHTML('beforeend', accountHTML);
            });
        }

        function addAccount() {
            const name = accountNameInput.value.trim();
            const balance = parseFloat(accountBalanceInput.value) || 0;
            if (!name) {
                alert('Por favor, digite o nome da conta.');
                return;
            }
            const newAccount = { id: new Date().getTime(), name: name, balance: balance };
            const accounts = getAccounts();
            accounts.push(newAccount);
            saveAccounts(accounts);
            loadAccounts();
            closeAddModal();
        }

        function saveAccountEdit() {
            const accountId = parseInt(editAccountIdInput.value);
            const newBalance = parseFloat(editBalanceInput.value);
            if (isNaN(newBalance)) {
                alert('Por favor, insira um valor válido.');
                return;
            }
            const accounts = getAccounts();
            const accountIndex = accounts.findIndex(acc => acc.id === accountId);
            if (accountIndex > -1) {
                accounts[accountIndex].balance = newBalance;
                saveAccounts(accounts);
                loadAccounts();
                closeEditModal();
            }
        }
        
        function deleteAccount(id) {
            let accounts = getAccounts();
            accounts = accounts.filter(account => account.id !== id);
            saveAccounts(accounts);
            loadAccounts();
        }

        const openAddModal = () => { addModal.style.display = 'flex'; accountNameInput.focus(); };
        const closeAddModal = () => { 
            addModal.style.display = 'none'; 
            accountNameInput.value = '';
            accountBalanceInput.value = '';
        };

        const openEditModal = (account) => {
            editModalTitle.textContent = `Editar Saldo de ${account.name}`;
            editBalanceInput.value = account.balance;
            editAccountIdInput.value = account.id;
            editModal.style.display = 'flex';
            editBalanceInput.focus();
        };
        const closeEditModal = () => { editModal.style.display = 'none'; };
        
        function initializeApp() {
            fabButton.addEventListener('click', openAddModal);
            cancelAddBtn.addEventListener('click', closeAddModal);
            addBtn.addEventListener('click', addAccount);
            saveEditBtn.addEventListener('click', saveAccountEdit);
            cancelEditBtn.addEventListener('click', closeEditModal);

            accountsList.addEventListener('click', (event) => {
                const accountItem = event.target.closest('.transaction-item');
                if (!accountItem) return;

                const accountId = parseInt(accountItem.dataset.id);
                const accounts = getAccounts();
                const accountClicked = accounts.find(acc => acc.id === accountId);

                if (event.target.classList.contains('delete-icon')) {
                    if (confirm(`Tem certeza que deseja excluir a conta "${accountClicked.name}"?`)) {
                        deleteAccount(accountId);
                    }
                } else {
                    if (accountClicked) {
                        openEditModal(accountClicked);
                    }
                }
            });

            loadAccounts();
        }


        if (sessionStorage.getItem('isLoggedIn') === 'true') {
            initializeApp();
        }
    });
    </script>

</body>
</html>